class LeaCloudSDK{constructor(t){this.best_route,this.serverList=t.serverList,this.interval=t.interval,this.token=t.token,this.callback=t.callback,this.result=[],this.onAjax=!1,this.autoTesting=!0}async start(){this.onAjax=!0,0!=this.serverList.length&&this.autoTesting&&(await this.nodeTest(),null!=this.callback&&this.callback()),this.onAjax=!1,0!=this.interval&&this.autoTesting&&await setTimeout(()=>this.start(),1e3*this.interval*60)}async nodeTest(){let t={};for(let i=0;i<this.serverList.length;i++)try{var s=(new Date).getTime();await this.makeRequest("GET",this.serverList[i]);var e=(new Date).getTime()-s;this.result.push([this.serverList[i],e,s]),t[this.serverList[i]]={response:e,datetime:s}}catch(e){console.log(e),t[this.serverList[i]]={response:0,datetime:s}}this.onAjax=!1,this.best_route=this.pick_best_route_so_far(),console.log(this.result),this.result=[],this.submitTestResult(JSON.stringify(t))}makeRequest(t,s,e=""){return new Promise((i,r)=>{let o=new XMLHttpRequest;o.open(t,s),o.timeout=1e3,o.onload=function(){200==o.status?i(s):r({url:s,status:o.status,statusText:o.statusText})},o.onerror=function(){r({url:s,status:o.status,statusText:"error"})},o.ontimeout=function(){r({url:s,status:o.status,statusText:"timeout"})},""!=e?o.send(e):o.send()})}submitTestResult(t){this.makeRequest("POST","https://sdk.nicecun.com:22000/sdk/receiver/"+this.token+"/",t)}sleep(t){return new Promise(s=>setTimeout(s,t))}pick_best_route_so_far(t=this.result){return t.sort(function(t,s){return t[1]<s[1]?-1:t[1]>s[1]?1:0}),t.map(t=>new URL(t[0]).origin)}getBestRoute(t=!1){return t?this.pick_best_route_so_far():null!=this.best_route?this.best_route:this.pick_best_route_so_far()}delBestRoute(t=0){this.onAjax&&(0==t?this.best_route.shift():this.best_route.splice(t,1))}setServerList(t=[]){this.serverList=t}stopAutoTesting(){this.autoTesting=!1}}