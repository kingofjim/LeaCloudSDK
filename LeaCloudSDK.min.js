class LeaCloudSDK{constructor(t){this.best_route,this.serverList=t.serverList,this.interval=t.interval,this.token=t.token,this.callback=t.callback,this.result=[],this.onAjax=!1,this.autoTesting=!0,this.localStorage="LeaCloudSDK - "+this.serverList.toString(),this.localStorageExpire="LeaCloudSDK.expire - "+this.serverList.toString()}async start(){this.onAjax=!0,0!=this.serverList.length&&this.autoTesting&&(await this.nodeTest(),null!=this.callback&&this.callback()),this.onAjax=!1,0!=this.interval&&this.autoTesting&&await setTimeout(()=>this.start(),1e3*this.interval*60)}async nodeTest(){let t={};for(let i=0;i<this.serverList.length;i++)try{var e=(new Date).getTime();await this.makeRequest("GET",this.serverList[i]);var s=(new Date).getTime()-e;this.result.push([this.serverList[i],s,e]),t[this.serverList[i]]={response:s,datetime:e}}catch(s){console.log(s),t[this.serverList[i]]={response:0,datetime:e}}this.onAjax=!1,this.best_route=this.pick_best_route_so_far(),console.log(this.result),this.setDefaultBestRoute(this.best_route),this.result=[],this.submitTestResult(JSON.stringify(t))}makeRequest(t,e,s=""){return new Promise((i,r)=>{let a=new XMLHttpRequest;a.open(t,e),a.timeout=1e3,a.onload=function(){200==a.status?i(e):r({url:e,status:a.status,statusText:a.statusText})},a.onerror=function(){r({url:e,status:a.status,statusText:"error"})},a.ontimeout=function(){r({url:e,status:a.status,statusText:"timeout"})},""!=s?a.send(s):a.send()})}submitTestResult(t){this.makeRequest("POST","https://sdk.nicecun.com:22000/sdk/receiver/"+this.token+"/",t)}sleep(t){return new Promise(e=>setTimeout(e,t))}pick_best_route_so_far(){var t=this.result;return t.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),t.map(t=>this.extractURL(t[0]))}getBestRoute(t=!1){return t?this.pick_best_route_so_far():null!=this.best_route?this.best_route:this.pick_best_route_so_far()}delBestRoute(t=0){this.onAjax&&(0==t?this.best_route.shift():this.best_route.splice(t,1))}setServerList(t=[]){this.serverList=t}stopAutoTesting(){this.autoTesting=!1}extractURL(t){let e=t.match(/(http|https)?:\/\/((.*?)\/|.*)/);return e[1]+"://"+e[e.length-1]}getDefaultBestRoute(){var t=localStorage.getItem(this.localStorageExpire);if(Date.now()<Number(t)){var e=localStorage.getItem(this.localStorage);if(null!=e){e=e.split(",");let t=-1;return this.serverList.forEach(s=>{var i=this.extractURL(s),r=e.indexOf(i);r>0&&(-1==t||r<t)&&(t=r)}),e[t]}}return null}setDefaultBestRoute(t){localStorage.setItem(this.localStorage,t),localStorage.setItem(this.localStorageExpire,Date.now()+86400)}}